<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="manifest" href="manifest.json" />
<title>WIN5</title>

<style>
:root {
  --bg: #0f1115;
  --text: #e9edf5;
  --muted: #aab3c5;
  --line: rgba(255,255,255,0.10);
  --shadow2: 0 6px 16px rgba(0,0,0,0.30);

  --navy: rgba(25,40,95,0.92);
  --navy-border: rgba(105,150,245,0.50);
  --navy-text: #f2f7ff;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  background: radial-gradient(1200px 800px at 15% 10%, rgba(90,140,255,0.10), transparent 55%),
              radial-gradient(900px 700px at 85% 0%, rgba(255,220,120,0.07), transparent 60%),
              var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
  -webkit-text-size-adjust: 100%;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 20;
  background: linear-gradient(180deg, rgba(15,17,21,0.98), rgba(15,17,21,0.86));
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--line);
  padding: calc(10px + env(safe-area-inset-top)) 12px 10px 12px;
}

.h1 {
  font-weight: 1000;
  letter-spacing: 0.02em;
  font-size: 18px;
  margin: 0;
}

.row {
  margin-top: 10px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 12px;
  background: var(--navy);
  border: 1px solid var(--navy-border);
  border-radius: 12px;
  color: var(--navy-text);
  font-weight: 1000;
  font-size: 12px;
  white-space: nowrap;
  cursor: pointer;
  user-select: none;
  text-decoration: none;
}
.btn:active {
  transform: scale(0.99);
  filter: brightness(1.08);
}

/* btn.glow は現在未使用（結果Yは card.glow を使用） */

.sel {
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--navy-border);
  background: var(--navy);
  color: var(--navy-text);
  font-weight: 1000;
  font-size: 12px;
  outline: none;
}

.wrapper {
  padding: 12px 12px calc(24px + env(safe-area-inset-bottom)) 12px;
}

.card {
  border: 1px solid var(--line);
  background: rgba(16,19,27,0.88);
  border-radius: 16px;
  box-shadow: var(--shadow2);
  overflow: hidden;
  margin-top: 12px;
}

/* 的中（購入に勝ち馬が含まれる） */
.card.glow {
  box-shadow: 0 0 0 1px rgba(255,220,120,0.70), 0 0 26px rgba(255,220,120,0.35), var(--shadow2);
  animation: glowRace 1.35s ease-in-out infinite;
}
@keyframes glowRace {
  0%   { filter: brightness(1.00); }
  50%  { filter: brightness(1.20); }
  100% { filter: brightness(1.00); }
}

/* 外し（結果がある & 購入に勝ち馬が含まれない） */
.card.miss {
  border-color: rgba(255,90,90,0.28);
  box-shadow: 0 0 0 1px rgba(255,90,90,0.18), var(--shadow2);
  filter: brightness(0.92) saturate(0.92);
}

.chead {
  padding: 12px 12px;
  border-bottom: 1px solid var(--line);
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 10px;
}

.ctitle {
  font-weight: 1000;
  font-size: 15px;
  line-height: 1.25;
}

.cmeta {
  font-weight: 900;
  font-size: 12px;
  color: var(--muted);
}

.cbody {
  padding: 12px 12px;
}

.picks {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.hrow {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
}

.hrow.winner {
  border-color: rgba(255,220,120,0.70);
  box-shadow: 0 0 0 1px rgba(255,220,120,0.55), 0 0 18px rgba(255,220,120,0.28);
  animation: glowWinner 1.35s ease-in-out infinite;
}
@keyframes glowWinner {
  0%   { filter: brightness(1.00); }
  50%  { filter: brightness(1.18); }
  100% { filter: brightness(1.00); }
}

.badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 42px;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 1000;
  font-size: 13px;
  border: 1px solid rgba(0,0,0,0.20);
}

.hname {
  font-weight: 1000;
  font-size: 13px;
  line-height: 1.25;
  flex: 1;
}

.hname.cand {
  color: rgba(233,237,245,0.72);
}

.mkr {
  min-width: 22px;
  text-align: right;
  font-weight: 1000;
  font-size: 13px;
  color: rgba(233,237,245,0.92);
}

.candsWrap {
  margin-top: 10px;
  display: none;
}

.empty {
  margin-top: 12px;
  border: 1px dashed rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.04);
  border-radius: 16px;
  padding: 14px;
  font-weight: 900;
  color: rgba(233,237,245,0.92);
  line-height: 1.5;
}

/* 枠色（枠番1..8） */
.w1 { background: #ffffff; color: #111; }
.w2 { background: #111111; color: #fff; border-color: rgba(255,255,255,0.22); }
.w3 { background: #e53935; color: #fff; }
.w4 { background: #1e88e5; color: #fff; }
.w5 { background: #fdd835; color: #111; }
.w6 { background: #43a047; color: #fff; }
.w7 { background: #fb8c00; color: #111; }
.w8 { background: #ec407a; color: #fff; }
</style>
</head>

<body>

<div class="topbar">
  <h1 class="h1">WIN5</h1>
  <div class="row">
    <select class="sel" id="dateSel"></select>
    <a class="btn" id="backBtn" href="index.html">Topへ戻る</a>
  </div>
</div>

<div class="wrapper">
  <div id="list"></div>
</div>

<script>
const WIN5_ALL = {"dates": ["20260104", "20260111", "20260112", "20260118", "20260124", "20260125", "20260201", "20260215"], "by_date": {"20260104": {"date": "20260104", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260104.csv", "races": [{"idx": 1, "date": "20260104", "track": "中山", "r": "9", "race_name": "招福ステークス 3勝", "race_id": "20260104_中山_9", "time": "14:30", "winner_umaban": "3", "winner_name": "アスクデビューモア", "hit_race": false, "picks": [{"umaban": "2", "wakuban": "2", "horse": "デコラシオン", "mark": "◎"}, {"umaban": "10", "wakuban": "8", "horse": "バギーウィップ", "mark": "○"}], "cands": [{"umaban": "3", "wakuban": "3", "horse": "アスクデビューモア", "mark": "△1"}], "raw_rows": 3}, {"idx": 2, "date": "20260104", "track": "京都", "r": "10", "race_name": "寿ステークス 3勝", "race_id": "20260104_京都_10", "time": "14:50", "winner_umaban": "2", "winner_name": "タガノデュード", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "8", "horse": "バッデレイト", "mark": "◎"}], "cands": [{"umaban": "2", "wakuban": "2", "horse": "タガノデュード", "mark": "○"}], "raw_rows": 2}, {"idx": 3, "date": "20260104", "track": "中山", "r": "10", "race_name": "ジュニアカップ L", "race_id": "20260104_中山_10", "time": "15:05", "winner_umaban": "4", "winner_name": "リゾートアイランド", "hit_race": false, "picks": [{"umaban": "4", "wakuban": "4", "horse": "リゾートアイランド", "mark": "◎"}], "cands": [{"umaban": "5", "wakuban": "5", "horse": "サレジオ", "mark": "○"}], "raw_rows": 2}, {"idx": 4, "date": "20260104", "track": "京都", "r": "11", "race_name": "第64回 スポーツニッポン賞京都金杯 G3", "race_id": "20260104_京都_11", "time": "15:30", "winner_umaban": "15", "winner_name": "ブエナオンダ", "hit_race": false, "picks": [{"umaban": "1", "wakuban": "1", "horse": "ランスオブカオス", "mark": "◎"}, {"umaban": "3", "wakuban": "2", "horse": "キープカルム", "mark": "○"}, {"umaban": "13", "wakuban": "7", "horse": "ガイアメンテ", "mark": "△1"}], "cands": [{"umaban": "15", "wakuban": "7", "horse": "ブエナオンダ", "mark": "△3"}], "raw_rows": 4}, {"idx": 5, "date": "20260104", "track": "中山", "r": "11", "race_name": "第75回 日刊スポーツ賞中山金杯 G3", "race_id": "20260104_中山_11", "time": "15:45", "winner_umaban": "11", "winner_name": "カラマティアノス", "hit_race": false, "picks": [{"umaban": "2", "wakuban": "2", "horse": "アンゴラブラック", "mark": "◎"}, {"umaban": "1", "wakuban": "1", "horse": "ケイアイセナ", "mark": "△3"}, {"umaban": "3", "wakuban": "3", "horse": "カネラフィーナ", "mark": "○"}], "cands": [{"umaban": "8", "wakuban": "5", "horse": "グランディア", "mark": "△1"}], "raw_rows": 4}]}, "20260111": {"date": "20260111", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260111.csv", "races": [{"idx": 1, "date": "20260111", "track": "中山", "r": "9", "race_name": "初咲賞 2勝", "race_id": "20260111_中山_9", "time": "14:30", "winner_umaban": "7", "winner_name": "コンドゥイア", "hit_race": false, "picks": [{"umaban": "7", "wakuban": "5", "horse": "コンドゥイア", "mark": "◎"}], "cands": [{"umaban": "8", "wakuban": "6", "horse": "コムユンプリュム", "mark": "○"}], "raw_rows": 2}, {"idx": 2, "date": "20260111", "track": "京都", "r": "10", "race_name": "新春ステークス 3勝", "race_id": "20260111_京都_10", "time": "14:50", "winner_umaban": "11", "winner_name": "ベラジオボンド", "hit_race": false, "picks": [{"umaban": "11", "wakuban": "6", "horse": "ベラジオボンド", "mark": "◎"}, {"umaban": "3", "wakuban": "2", "horse": "ミニトランザット", "mark": "○"}, {"umaban": "8", "wakuban": "5", "horse": "ミッキージュエリー", "mark": "▲"}], "cands": [{"umaban": "2", "wakuban": "2", "horse": "ウィープディライト", "mark": "△1"}], "raw_rows": 4}, {"idx": 3, "date": "20260111", "track": "中山", "r": "10", "race_name": "ポルックスステークス OP", "race_id": "20260111_中山_10", "time": "15:05", "winner_umaban": "3", "winner_name": "カゼノランナー", "hit_race": false, "picks": [{"umaban": "13", "wakuban": "7", "horse": "ハビレ", "mark": "◎"}, {"umaban": "14", "wakuban": "7", "horse": "テーオーグランビル", "mark": "○"}, {"umaban": "8", "wakuban": "4", "horse": "ポッドロゴ", "mark": "△3"}], "cands": [{"umaban": "10", "wakuban": "5", "horse": "ハギノサステナブル", "mark": "△1"}], "raw_rows": 4}, {"idx": 4, "date": "20260111", "track": "京都", "r": "11", "race_name": "淀短距離ステークス L", "race_id": "20260111_京都_11", "time": "15:30", "winner_umaban": "12", "winner_name": "ヤブサメ", "hit_race": false, "picks": [{"umaban": "12", "wakuban": "6", "horse": "ヤブサメ", "mark": "◎"}, {"umaban": "5", "wakuban": "3", "horse": "デュガ", "mark": "○"}], "cands": [{"umaban": "6", "wakuban": "3", "horse": "アンクルクロス", "mark": "▲"}], "raw_rows": 3}, {"idx": 5, "date": "20260111", "track": "中山", "r": "11", "race_name": "第42回 フェアリーステークス G3", "race_id": "20260111_中山_11", "time": "15:45", "winner_umaban": "15", "winner_name": "ブラックチャリス", "hit_race": false, "picks": [{"umaban": "2", "wakuban": "1", "horse": "ピエドゥラパン", "mark": "◎"}], "cands": [{"umaban": "9", "wakuban": "5", "horse": "サンアントワーヌ", "mark": "▲"}], "raw_rows": 2}]}, "20260112": {"date": "20260112", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260112.csv", "races": [{"idx": 1, "date": "20260112", "track": "京都", "r": "9", "race_name": "琵琶湖特別 2勝", "race_id": "20260112_京都_9", "time": "14:30", "winner_umaban": "10", "winner_name": "アロンディ", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "6", "horse": "キングスコール", "mark": "◎"}, {"umaban": "10", "wakuban": "7", "horse": "アロンディ", "mark": "▲"}], "cands": [{"umaban": "4", "wakuban": "4", "horse": "ウインデイジー", "mark": "○"}], "raw_rows": 3}, {"idx": 2, "date": "20260112", "track": "中山", "r": "10", "race_name": "初春ステークス 3勝", "race_id": "20260112_中山_10", "time": "14:50", "winner_umaban": "15", "winner_name": "ドラゴンウェルズ", "hit_race": false, "picks": [{"umaban": "15", "wakuban": "8", "horse": "ドラゴンウェルズ", "mark": "◎"}], "cands": [{"umaban": "11", "wakuban": "6", "horse": "ドンレパルス", "mark": "▲"}], "raw_rows": 2}, {"idx": 3, "date": "20260112", "track": "京都", "r": "10", "race_name": "雅ステークス 3勝", "race_id": "20260112_京都_10", "time": "15:05", "winner_umaban": "15", "winner_name": "モックモック", "hit_race": false, "picks": [{"umaban": "7", "wakuban": "4", "horse": "デルアヴァー", "mark": "◎"}, {"umaban": "8", "wakuban": "4", "horse": "パシアンジャン", "mark": "▲"}, {"umaban": "3", "wakuban": "2", "horse": "ペンナヴェローチェ", "mark": "○"}], "cands": [{"umaban": "11", "wakuban": "6", "horse": "タガノマカシヤ", "mark": "△1"}], "raw_rows": 4}, {"idx": 4, "date": "20260112", "track": "中山", "r": "11", "race_name": "ニューイヤーステークス L", "race_id": "20260112_中山_11", "time": "15:30", "winner_umaban": "4", "winner_name": "カピリナ", "hit_race": false, "picks": [{"umaban": "1", "wakuban": "1", "horse": "ダノンエアズロック", "mark": "◎"}], "cands": [{"umaban": "8", "wakuban": "5", "horse": "ファンダム", "mark": "○"}], "raw_rows": 2}, {"idx": 5, "date": "20260112", "track": "京都", "r": "11", "race_name": "第60回 日刊スポーツ賞シンザン記念 G3", "race_id": "20260112_京都_11", "time": "15:45", "winner_umaban": "3", "winner_name": "サンダーストラック", "hit_race": false, "picks": [{"umaban": "13", "wakuban": "7", "horse": "モノポリオ", "mark": "◎"}, {"umaban": "11", "wakuban": "6", "horse": "バルセシート", "mark": "○"}, {"umaban": "1", "wakuban": "1", "horse": "アルトラムス", "mark": "△3"}], "cands": [{"umaban": "16", "wakuban": "8", "horse": "サウンドムーブ", "mark": "△1"}], "raw_rows": 4}]}, "20260118": {"date": "20260118", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260118.csv", "races": [{"idx": 1, "date": "20260118", "track": "中山", "r": "9", "race_name": "若潮ステークス 3勝", "race_id": "20260118_中山_9", "time": "14:30", "winner_umaban": "7", "winner_name": "ポルカリズム", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "5", "horse": "グローリーリンク", "mark": "◎"}], "cands": [{"umaban": "5", "wakuban": "3", "horse": "コートアリシアン", "mark": "○"}], "raw_rows": 2}, {"idx": 2, "date": "20260118", "track": "京都", "r": "10", "race_name": "大津特別 2勝", "race_id": "20260118_京都_10", "time": "14:50", "winner_umaban": "12", "winner_name": "バッケンレコード", "hit_race": false, "picks": [{"umaban": "12", "wakuban": "6", "horse": "バッケンレコード", "mark": "◎"}, {"umaban": "8", "wakuban": "4", "horse": "ショーダンサー", "mark": "○"}, {"umaban": "7", "wakuban": "4", "horse": "メイショウヤシマ", "mark": "▲"}], "cands": [{"umaban": "1", "wakuban": "1", "horse": "キングブルー", "mark": "△1"}], "raw_rows": 4}, {"idx": 3, "date": "20260118", "track": "中山", "r": "10", "race_name": "ジャニュアリーステークス OP", "race_id": "20260118_中山_10", "time": "15:05", "winner_umaban": "14", "winner_name": "モンドプリューム", "hit_race": false, "picks": [{"umaban": "6", "wakuban": "3", "horse": "エコロアゼル", "mark": "◎"}, {"umaban": "10", "wakuban": "5", "horse": "アメリカンステージ", "mark": "○"}], "cands": [{"umaban": "12", "wakuban": "6", "horse": "ロードアウォード", "mark": "▲"}], "raw_rows": 3}, {"idx": 4, "date": "20260118", "track": "京都", "r": "11", "race_name": "第73回 日経新春杯 G2", "race_id": "20260118_京都_11", "time": "15:30", "winner_umaban": "6", "winner_name": "ゲルチュタール", "hit_race": false, "picks": [{"umaban": "6", "wakuban": "5", "horse": "ゲルチュタール", "mark": "◎"}], "cands": [{"umaban": "2", "wakuban": "2", "horse": "サトノグランツ", "mark": "○"}], "raw_rows": 2}, {"idx": 5, "date": "20260118", "track": "中山", "r": "11", "race_name": "第66回 京成杯 G3", "race_id": "20260118_中山_11", "time": "15:45", "winner_umaban": "4", "winner_name": "グリーンエナジー", "hit_race": false, "picks": [{"umaban": "4", "wakuban": "3", "horse": "グリーンエナジー", "mark": "◎"}, {"umaban": "15", "wakuban": "8", "horse": "アクセス", "mark": "△2"}, {"umaban": "12", "wakuban": "7", "horse": "ソラネルマン", "mark": "○"}], "cands": [{"umaban": "13", "wakuban": "7", "horse": "ポルフュロゲネトス", "mark": "△1"}], "raw_rows": 4}]}, "20260124": {"date": "20260124", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260124.csv", "races": [{"idx": 1, "date": "20260124", "track": "京都", "r": "10", "race_name": "下鴨ステークス 3勝", "race_id": "20260124_京都_10", "time": "14:45", "winner_umaban": "4", "winner_name": "アスクシュタイン", "hit_race": false, "picks": [{"umaban": "4", "wakuban": "3", "horse": "アスクシュタイン", "mark": "◎"}], "cands": [{"umaban": "10", "wakuban": "6", "horse": "シンビリーブ", "mark": "○"}], "raw_rows": 2}, {"idx": 2, "date": "20260124", "track": "中山", "r": "10", "race_name": "初霞賞 2勝", "race_id": "20260124_中山_10", "time": "14:55", "winner_umaban": "1", "winner_name": "プルナチャンドラ", "hit_race": false, "picks": [{"umaban": "7", "wakuban": "7", "horse": "サノノワンダー", "mark": "○"}], "cands": [{"umaban": "1", "wakuban": "1", "horse": "プルナチャンドラ", "mark": "◎"}], "raw_rows": 2}, {"idx": 3, "date": "20260124", "track": "京都", "r": "11", "race_name": "睦月ステークス OP", "race_id": "20260124_京都_11", "time": "15:20", "winner_umaban": "5", "winner_name": "レイベリング", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "5", "horse": "シヴァース", "mark": "◎"}, {"umaban": "4", "wakuban": "3", "horse": "マイネルチケット", "mark": "○"}], "cands": [{"umaban": "10", "wakuban": "6", "horse": "タガノエルピーダ", "mark": "△2"}], "raw_rows": 3}, {"idx": 4, "date": "20260124", "track": "中山", "r": "11", "race_name": "初富士ステークス 3勝", "race_id": "20260124_中山_11", "time": "15:30", "winner_umaban": "16", "winner_name": "エセルフリーダ", "hit_race": false, "picks": [{"umaban": "7", "wakuban": "4", "horse": "シャドウメテオ", "mark": "◎"}, {"umaban": "10", "wakuban": "5", "horse": "ショウナンラピダス", "mark": "▲"}, {"umaban": "16", "wakuban": "8", "horse": "エセルフリーダ", "mark": "○"}], "cands": [{"umaban": "8", "wakuban": "4", "horse": "ドットクルー", "mark": "△1"}], "raw_rows": 4}, {"idx": 5, "date": "20260124", "track": "小倉", "r": "11", "race_name": "第2回 小倉牝馬ステークス G3", "race_id": "20260124_小倉_11", "time": "15:45", "winner_umaban": "17", "winner_name": "ジョスラン", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "4", "horse": "ココナッツブラウン", "mark": "◎"}, {"umaban": "17", "wakuban": "8", "horse": "ジョスラン", "mark": "○"}, {"umaban": "1", "wakuban": "1", "horse": "テレサ", "mark": "▲"}], "cands": [{"umaban": "15", "wakuban": "7", "horse": "レディーヴァリュー", "mark": "△1"}], "raw_rows": 4}]}, "20260125": {"date": "20260125", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260125.csv", "races": [{"idx": 1, "date": "20260125", "track": "京都", "r": "10", "race_name": "山城ステークス 3勝", "race_id": "20260125_京都_10", "time": "14:50", "winner_umaban": "17", "winner_name": "ララマセラシオン", "hit_race": false, "picks": [{"umaban": "11", "wakuban": "6", "horse": "チューラワンサ", "mark": "○"}, {"umaban": "2", "wakuban": "1", "horse": "モジャーリオ", "mark": "◎"}], "cands": [{"umaban": "9", "wakuban": "5", "horse": "ケーブパール", "mark": "▲"}], "raw_rows": 3}, {"idx": 2, "date": "20260125", "track": "中山", "r": "10", "race_name": "江戸川ステークス 3勝", "race_id": "20260125_中山_10", "time": "15:01", "winner_umaban": "9", "winner_name": "ルディック", "hit_race": false, "picks": [{"umaban": "16", "wakuban": "8", "horse": "ワンダラー", "mark": "○"}, {"umaban": "9", "wakuban": "5", "horse": "ルディック", "mark": "▲"}, {"umaban": "4", "wakuban": "2", "horse": "ドンレパルス", "mark": "◎"}], "cands": [{"umaban": "14", "wakuban": "7", "horse": "フウセツ", "mark": "△1"}], "raw_rows": 4}, {"idx": 3, "date": "20260125", "track": "小倉", "r": "11", "race_name": "壇之浦ステークス 3勝", "race_id": "20260125_小倉_11", "time": "15:15", "winner_umaban": "5", "winner_name": "エラトー", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "6", "horse": "アウフヘーベン", "mark": "◎"}], "cands": [{"umaban": "2", "wakuban": "2", "horse": "イガッチ", "mark": "△1"}], "raw_rows": 2}, {"idx": 4, "date": "20260125", "track": "京都", "r": "11", "race_name": "第31回 プロキオンステークス G2", "race_id": "20260125_京都_11", "time": "15:30", "winner_umaban": "13", "winner_name": "ロードクロンヌ", "hit_race": false, "picks": [{"umaban": "13", "wakuban": "7", "horse": "ロードクロンヌ", "mark": "◎"}], "cands": [{"umaban": "10", "wakuban": "5", "horse": "ジェイパームス", "mark": "○"}], "raw_rows": 2}, {"idx": 5, "date": "20260125", "track": "中山", "r": "11", "race_name": "第67回 アメリカジョッキークラブカップ G2", "race_id": "20260125_中山_11", "time": "15:45", "winner_umaban": "9", "winner_name": "ショウヘイ", "hit_race": false, "picks": [{"umaban": "4", "wakuban": "2", "horse": "ジョバンニ", "mark": "◎"}, {"umaban": "14", "wakuban": "7", "horse": "ドゥラドーレス", "mark": "○"}, {"umaban": "3", "wakuban": "2", "horse": "マイネルエンペラー", "mark": "▲"}], "cands": [{"umaban": "9", "wakuban": "5", "horse": "ショウヘイ", "mark": "△1"}], "raw_rows": 4}]}, "20260201": {"date": "20260201", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260201.csv", "races": [{"idx": 1, "date": "20260201", "track": "京都", "r": "10", "race_name": "八坂ステークス 3勝", "race_id": "20260201_京都_10", "time": "14:50", "winner_umaban": "2", "winner_name": "メイショウゲキリン", "hit_race": false, "picks": [{"umaban": "3", "wakuban": "3", "horse": "レクスノヴァス", "mark": "◎"}], "cands": [{"umaban": "8", "wakuban": "8", "horse": "ミラージュナイト", "mark": "▲"}], "raw_rows": 2}, {"idx": 2, "date": "20260201", "track": "東京", "r": "10", "race_name": "節分ステークス 3勝", "race_id": "20260201_東京_10", "time": "15:01", "winner_umaban": "14", "winner_name": "ウイントワイライト", "hit_race": false, "picks": [{"umaban": "3", "wakuban": "2", "horse": "スマートワイス", "mark": "◎"}], "cands": [{"umaban": "14", "wakuban": "8", "horse": "ウイントワイライト", "mark": "○"}], "raw_rows": 2}, {"idx": 3, "date": "20260201", "track": "小倉", "r": "11", "race_name": "門司ステークス OP", "race_id": "20260201_小倉_11", "time": "15:15", "winner_umaban": "6", "winner_name": "コトホドサヨウニ", "hit_race": false, "picks": [{"umaban": "13", "wakuban": "7", "horse": "ハギノサステナブル", "mark": "◎"}, {"umaban": "2", "wakuban": "2", "horse": "レイナデアルシーラ", "mark": "△1"}, {"umaban": "1", "wakuban": "1", "horse": "スナークラファエロ", "mark": "▲"}], "cands": [{"umaban": "12", "wakuban": "7", "horse": "ラタフォレスト", "mark": "○"}], "raw_rows": 4}, {"idx": 4, "date": "20260201", "track": "京都", "r": "11", "race_name": "第31回 シルクロードステークス G3", "race_id": "20260201_京都_11", "time": "15:30", "winner_umaban": "14", "winner_name": "フィオライア", "hit_race": false, "picks": [{"umaban": "16", "wakuban": "8", "horse": "ロードフォアエース", "mark": "◎"}, {"umaban": "4", "wakuban": "2", "horse": "カルプスペルシュ", "mark": "○"}], "cands": [{"umaban": "12", "wakuban": "6", "horse": "エーティーマクフィ", "mark": "△1"}], "raw_rows": 3}, {"idx": 5, "date": "20260201", "track": "東京", "r": "11", "race_name": "第40回 根岸ステークス G3", "race_id": "20260201_東京_11", "time": "15:45", "winner_umaban": "2", "winner_name": "ロードフォンス", "hit_race": false, "picks": [{"umaban": "8", "wakuban": "4", "horse": "インユアパレス", "mark": "◎"}, {"umaban": "9", "wakuban": "5", "horse": "エンペラーワケア", "mark": "○"}, {"umaban": "7", "wakuban": "4", "horse": "ダノンフィーゴ", "mark": "▲"}], "cands": [{"umaban": "1", "wakuban": "1", "horse": "ウェイワードアクト", "mark": "△1"}], "raw_rows": 4}]}, "20260215": {"date": "20260215", "generated_at": "2026-02-15 17:49:46", "source_csv": "win5_20260215.csv", "races": [{"idx": 1, "date": "20260215", "track": "京都", "r": "10", "race_name": "北山ステークス 3勝", "race_id": "20260215_京都_10", "time": "14:50", "winner_umaban": "10", "winner_name": "グランドプラージュ", "hit_race": false, "picks": [{"umaban": "10", "wakuban": "8", "horse": "グランドプラージュ", "mark": "◎"}], "cands": [{"umaban": "5", "wakuban": "5", "horse": "ペンナヴェローチェ", "mark": "○"}], "raw_rows": 2}, {"idx": 2, "date": "20260215", "track": "東京", "r": "10", "race_name": "バレンタインステークス OP", "race_id": "20260215_東京_10", "time": "15:01", "winner_umaban": "2", "winner_name": "ウェットシーズン", "hit_race": false, "picks": [{"umaban": "6", "wakuban": "3", "horse": "ドンインザムード", "mark": "◎"}, {"umaban": "3", "wakuban": "2", "horse": "ノーブルロジャー", "mark": "▲"}, {"umaban": "11", "wakuban": "6", "horse": "エストレヤデベレン", "mark": "○"}], "cands": [{"umaban": "2", "wakuban": "1", "horse": "ウェットシーズン", "mark": "△1"}], "raw_rows": 4}, {"idx": 3, "date": "20260215", "track": "小倉", "r": "11", "race_name": "北九州短距離ステークス OP", "race_id": "20260215_小倉_11", "time": "15:15", "winner_umaban": "7", "winner_name": "ジョーメッドヴィン", "hit_race": false, "picks": [{"umaban": "18", "wakuban": "8", "horse": "ナムラクララ", "mark": "◎"}, {"umaban": "11", "wakuban": "6", "horse": "カルロヴェローチェ", "mark": "○"}, {"umaban": "2", "wakuban": "1", "horse": "デイトナモード", "mark": "▲"}], "cands": [{"umaban": "13", "wakuban": "7", "horse": "アスクワンタイム", "mark": "△1"}], "raw_rows": 4}, {"idx": 4, "date": "20260215", "track": "京都", "r": "11", "race_name": "第119回 京都記念 G2", "race_id": "20260215_京都_11", "time": "15:30", "winner_umaban": "12", "winner_name": "ジューンテイク", "hit_race": false, "picks": [{"umaban": "6", "wakuban": "5", "horse": "エリキング", "mark": "○"}, {"umaban": "1", "wakuban": "1", "horse": "ヘデントール", "mark": "◎"}], "cands": [{"umaban": "8", "wakuban": "6", "horse": "シェイクユアハート", "mark": "△3"}], "raw_rows": 3}, {"idx": 5, "date": "20260215", "track": "東京", "r": "11", "race_name": "第60回 共同通信杯 G3", "race_id": "20260215_東京_11", "time": "15:45", "winner_umaban": "5", "winner_name": "リアライズシリウス", "hit_race": false, "picks": [{"umaban": "6", "wakuban": "6", "horse": "ロブチェン", "mark": "◎"}], "cands": [{"umaban": "5", "wakuban": "5", "horse": "リアライズシリウス", "mark": "○"}], "raw_rows": 2}]}}};
const DEFAULT_DATE = "";

function esc(s) {
  const v = (s === null || s === undefined) ? "" : s;
  return String(v).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

function getHashDate() {
  const h = (location.hash || "").replace(/^#/, "");
  for (const part of h.split("&")) {
    const [k,v] = part.split("=");
    if (k === "date") return decodeURIComponent(v || "");
  }
  return "";
}

function setHashDate(d) {
  location.hash = "date=" + encodeURIComponent(d);
}

function normPlace(placeName) {
  let s = String(placeName || "").trim();
  if (!s) return "";
  s = s.replace(/\u3000/g, " ").replace(/\s+/g, "");
  s = s.replace(/競馬場/g, "");
  s = s.replace(/[（(]外[）)]/g, "");
  s = s.replace(/外$/g, "");
  const keys = ["札幌","函館","福島","新潟","東京","中山","中京","京都","阪神","小倉"];
  for (const k of keys) {
    if (s.includes(k)) return k;
  }
  return s;
}

function makeViewerLink(date, track, r) {
  const t = normPlace(track);
  const rr = String(r || "").match(/\d+/);
  const rno = rr ? String(parseInt(rr[0], 10)) : "";
  const parts = [];
  if (date) parts.push("date=" + encodeURIComponent(date));
  if (t) parts.push("track=" + encodeURIComponent(t));
  if (rno) parts.push("race=" + encodeURIComponent(rno));
  return "keiba_viewer.html#" + parts.join("&");
}

function fillDateSelect(dates, selected) {
  const sel = document.getElementById("dateSel");
  sel.innerHTML = "";
  for (const d of dates) {
    const opt = document.createElement("option");
    opt.value = d;
    opt.textContent = d;
    sel.appendChild(opt);
  }
  if (selected && dates.includes(selected)) {
    sel.value = selected;
  } else if (dates.length) {
    sel.value = dates[0];
  }
}

function badgeClassByWaku(w) {
  const n = String(w || "").match(/\d+/);
  if (!n) return "";
  const k = parseInt(n[0], 10);
  if (k >= 1 && k <= 8) return "w" + String(k);
  return "";
}

function makeHorseRow(h, isCand) {
  const um = String(h.umaban || "");
  const wk = String(h.wakuban || "");
  const hn = String(h.horse || "");
  const mk = String(h.mark || "");

  const row = document.createElement("div");
  const winnerNo = String(h.__winnerNo || "");
  const isWinner = winnerNo && (String(h.umaban || "") === winnerNo);
  row.className = "hrow" + (isWinner ? " winner" : "");

  const badge = document.createElement("div");
  badge.className = "badge " + badgeClassByWaku(wk);
  badge.textContent = um || "—";

  const name = document.createElement("div");
  name.className = "hname" + (isCand ? " cand" : "");
  name.textContent = hn ? hn : "（馬名なし）";

  const mark = document.createElement("div");
  mark.className = "mkr";
  mark.textContent = mk || "";

  row.appendChild(badge);
  row.appendChild(name);
  row.appendChild(mark);
  return row;
}

function renderForDate(d) {
  const backBtn = document.getElementById("backBtn");
  const list = document.getElementById("list");

  backBtn.href = d ? ("index.html#date=" + encodeURIComponent(d)) : "index.html";

  list.innerHTML = "";

  const one = (WIN5_ALL.by_date && WIN5_ALL.by_date[d]) ? WIN5_ALL.by_date[d] : null;
  if (!one || !one.races || one.races.length === 0) {
    const box = document.createElement("div");
    box.className = "empty";
    box.textContent = "この日付のWIN5対象が見つかりませんでした。";
    list.appendChild(box);
    return;
  }

  for (const r of one.races) {
    const idx = r.idx || 0;
    const track = String(r.track || "");
    const rn = String(r.r || "");
    const raceName = String(r.race_name || "");
    const raceTime = String(r.time || "");
    const hitRace = !!r.hit_race;
    const picks = (r.picks || []);
    const cands = (r.cands || []);
    const winnerNo = String(r.winner_umaban || "");
    const winnerName = String(r.winner_name || "");
    const hasResult = !!(winnerNo || winnerName);

    const card = document.createElement("div");
    card.className = "card" + (hitRace ? " glow" : (hasResult ? " miss" : ""));

    const head = document.createElement("div");
    head.className = "chead";

    const title = document.createElement("div");
    title.className = "ctitle";
    const line1 = "第" + esc(idx) + "戦　" + esc(track) + (rn ? (" " + esc(rn) + "R") : "");
    const line2 = raceName ? esc(raceName) : "";
    title.innerHTML = line1 + (line2 ? "<br>" + line2 : "");

    const meta = document.createElement("div");
    meta.className = "cmeta";
    const t1 = raceTime ? ("発走 " + esc(raceTime)) : "発走 —";
    const t2 = (picks.length ? ("購入 " + picks.length + "頭") : "購入 —");
    meta.innerHTML = t1 + "<br>" + t2;

    head.appendChild(title);
    head.appendChild(meta);

    const body = document.createElement("div");
    body.className = "cbody";

    const picksBox = document.createElement("div");
    picksBox.className = "picks";

    if (!picks.length) {
      const e = document.createElement("div");
      e.className = "empty";
      e.textContent = "（購入馬が取れません）";
      picksBox.appendChild(e);
    } else {
      for (const h of picks) {
        const hh = Object.assign({}, h, { __winnerNo: winnerNo });
        picksBox.appendChild(makeHorseRow(hh, false));
      }
    }

    const row2 = document.createElement("div");
    row2.className = "row";

    const a = document.createElement("a");
    a.className = "btn";
    a.href = makeViewerLink(d, track, rn);
    a.textContent = "出馬表へ";
    row2.appendChild(a);

    // 追加馬（デフォルト非表示）
    let cWrap = null;
    if (cands && cands.length > 0) {
      const b = document.createElement("button");
      b.className = "btn";
      b.type = "button";
      b.textContent = "追加馬を表示";

      cWrap = document.createElement("div");
      cWrap.className = "candsWrap";

      const cBox = document.createElement("div");
      cBox.className = "picks";
      for (const h of cands) {
        const hh = Object.assign({}, h, { __winnerNo: winnerNo });
        cBox.appendChild(makeHorseRow(hh, true));
      }
      cWrap.appendChild(cBox);

      b.addEventListener("click", () => {
        const open = cWrap.style.display === "block";
        cWrap.style.display = open ? "none" : "block";
        b.textContent = open ? "追加馬を表示" : "追加馬を非表示";
      });

      row2.appendChild(b);
    }

    body.appendChild(picksBox);

    if (winnerNo || winnerName) {
      const res = document.createElement("div");
      res.className = "cmeta";
      res.style.marginTop = "10px";
      res.innerHTML = "結果 " + (winnerNo ? esc(winnerNo) : "—") + (winnerName ? (" " + esc(winnerName)) : "");
      body.appendChild(res);
    }

    body.appendChild(row2);
    if (cWrap) body.appendChild(cWrap);

    card.appendChild(head);
    card.appendChild(body);
    list.appendChild(card);
  }
}

function init() {
  const dates = (WIN5_ALL.dates || []).map(x => String(x));
  dates.sort().reverse();

  let d = getHashDate();
  if (!d) d = DEFAULT_DATE || "";
  if (!d && dates.length) d = dates[0];

  fillDateSelect(dates, d);
  if (d) setHashDate(d);
  renderForDate(d);

  const sel = document.getElementById("dateSel");
  sel.addEventListener("change", () => {
    const nd = String(sel.value || "");
    if (nd) setHashDate(nd);
    renderForDate(nd);
  });

  window.addEventListener("hashchange", () => {
    const hd = getHashDate();
    if (!hd) return;
    if (sel.value !== hd) sel.value = hd;
    renderForDate(hd);
  });
}

init();
</script>

</body>
</html>
